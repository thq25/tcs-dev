<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Workstations Configurator — 4 Recommendations, Parts Picker & Compare</title>
  <style>
    :root {
      --bg: #0f1115;
      --panel: #171a21;
      --emph: #1e222b;
      --text: #e8eef5;
      --muted: #aeb8c4;
      --accent: #5cc8ff;
      --accent-2: #8bde64;
      --danger: #ff6b6b;
      --warn: #ffd166;
      --ok: #2ecc71;
      --line: #232a33;
    }
    html, body {
      background: var(--bg);
      color: var(--text);
      margin: 0;
      font: 15.5px/1.55 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 28px 18px 120px; }
    header.hero {
      background: linear-gradient(180deg, rgba(92,200,255,0.08), transparent 60%), var(--panel);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 20px;
      margin-bottom: 18px;
    }
    h1, h2, h3 { margin: 10px 0 6px; line-height: 1.25; }
    h1 { font-size: 26px; }
    h2 { font-size: 21px; margin-top: 18px; }
    h3 { font-size: 18px; margin-top: 14px; color: #dce7f3; }
    p { margin: 6px 0 10px; color: var(--text); }
    .muted { color: var(--muted); }
    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }
    @media (min-width: 920px) {
      .grid-2 { grid-template-columns: 1.1fr 0.9fr; }
      .grid-3 { grid-template-columns: repeat(3, 1fr); }
    }
    .card {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 14px;
    }
    .section-title {
      display: flex; align-items: center; justify-content: space-between;
      gap: 8px; margin-bottom: 6px;
    }
    .kvs { display: grid; grid-template-columns: 170px 1fr; gap: 6px 12px; }
    .kv-key { color: var(--muted); }
    .kv-val { color: var(--text); }
    .tag {
      display: inline-block; padding: 2px 8px; border-radius: 999px; border: 1px solid var(--line);
      background: var(--emph); color: var(--text); font-size: 12px; margin-right: 6px;
    }
    .ok { color: var(--accent-2); }
    .warn { color: var(--warn); }
    .danger { color: var(--danger); }
    .table {
      width: 100%;
      border-collapse: collapse;
      margin: 6px 0 8px;
      font-size: 14px;
    }
    .table th, .table td {
      border-bottom: 1px solid var(--line);
      padding: 8px 10px;
      vertical-align: top;
    }
    .table th { text-align: left; color: var(--muted); font-weight: 600; }
    .table tfoot td {
      border-top: 1px solid var(--line);
      font-weight: 700;
    }
    .small { font-size: 12.5px; color: var(--muted); }
    .note { background: #12161d; border-left: 3px solid var(--accent); padding: 8px 10px; border-radius: 6px; }
    .btn-row { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    button, .btn {
      cursor: pointer;
      background: var(--emph);
      color: var(--text);
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 8px 10px;
      font-weight: 600;
    }
    button.accent, .btn.accent { background: #1d2937; border-color: #2a3646; }
    button.primary, .btn.primary { background: #0e7dd8; border-color: #0f75c7; }
    button.ghost, .btn.ghost { background: transparent; }
    button.warn { background: #2a1f00; border-color: #3a2d03; color: #ffd166; }
    .flex { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .picker-type {
      border: 1px dashed #2a3140;
      border-radius: 10px;
      padding: 10px;
      margin: 8px 0;
      background: #12161d;
    }
    .picker-type h4 { margin: 0 0 6px; font-size: 15px; color: #dce7f3; }
    .picker-row {
      display: grid; grid-template-columns: 1.2fr 0.45fr 0.55fr auto;
      gap: 8px; align-items: center; margin: 6px 0;
    }
    .picker-row select, .picker-row input {
      width: 100%; background: var(--panel); color: var(--text);
      border: 1px solid var(--line); border-radius: 8px; padding: 7px 8px;
    }
    .picker-row .row-sub { color: var(--muted); font-size: 13px; }
    .picker-row .rmv { color: var(--danger); background: #2a1515; border-color: #3a2121; }
    .summary {
      position: sticky; bottom: 12px; background: rgba(18,22,29,0.95);
      backdrop-filter: blur(6px);
      border: 1px solid var(--line); border-radius: 10px; padding: 10px; margin-top: 10px;
    }
    .summary .total { font-size: 18px; font-weight: 800; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .pill {
      display: inline-flex; align-items: center; gap: 6px; padding: 2px 8px; border-radius: 999px;
      border: 1px solid var(--line); background: #10151d; font-size: 12px;
    }
    .hr { height: 1px; background: var(--line); margin: 12px 0; }
    code.inline {
      background: #11151c; border: 1px solid #222a36; padding: 2px 6px; border-radius: 6px; font-size: 13px;
    }
    /* Compare modal */
    #compare-modal {
      position: fixed; inset: 0; display: none; align-items: center; justify-content: center;
      background: rgba(0,0,0,0.55); z-index: 9999;
    }
    #compare-modal .modal-card {
      width: min(1000px, 95vw); max-height: 85vh; overflow: auto;
      background: var(--panel); border: 1px solid var(--line); border-radius: 12px; padding: 14px;
    }
    .badge { display: inline-block; min-width: 20px; text-align: center; font-weight: 700; padding: 1px 6px; border-radius: 999px; background: #1b2230; border: 1px solid #2a3140; }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <h1>AI Workstations Configurator & Recommendations</h1>
      <p>We’ve prepared four pragmatic recommendations and a build picker that enforces compatibility using Build Type. Load any preset, customize parts, export a quote, and compare up to three builds side‑by‑side.</p>
      <div class="flex">
        <span class="pill">4 recommendations → loadable presets</span>
        <span class="pill">Compatibility locked by Build Type</span>
        <span class="pill">Compare up to 3 builds</span>
      </div>
    </header>

    <section class="card">
      <div class="section-title">
        <h2>Pipeline and recommendation overview</h2>
        <span class="small">Mapped to the set builder presets below</span>
      </div>
      <p>Based on typical AI/RAG workflows (ingestion, parsing, embedding, vector index, hybrid retrieval), we propose four hardware paths that cover exploration through enterprise‑grade scaling. Each recommendation below is available as a preset you can load into the builder, with compatibility enforced via Build Type:</p>

      <div class="kvs small">
        <div class="kv-key">Rec 1 — Existing PC</div><div class="kv-val">Single‑GPU upgrade: RTX 5090 ASUS ROG Astral OC. Simple, high single‑GPU performance for exploration and pilot work.</div>
        <div class="kv-key">Rec 2 — High‑end Desktop</div><div class="kv-val">Ryzen 9 9950X3D + AM5 platform + fast DDR5 + Gen5 NVMe + RTX 5090. Flexible, modern desktop for production apps.</div>
        <div class="kv-key">Rec 3 — Server‑grade</div><div class="kv-val">EPYC 7702 + 4× RTX 3090. Proven throughput for big batch processing and mass document embedding.</div>
        <div class="kv-key">Rec 4 — Workstation Pro</div><div class="kv-val">Threadripper PRO 9965WX + WRX90E + RTX 5090 + ECC DDR5. Enterprise‑grade, future‑proof, great for audits/tenders.</div>
      </div>

      <div class="note small">
        Load any preset from the Recommendations panel to the right, customize in the picker, export the bill of materials, and optionally save and compare up to three builds.
      </div>
    </section>

    <section class="grid grid-2">
      <div class="card">
        <div class="section-title">
          <h2>Help on Considering your setup</h2>
          <span class="small">a brief explanation</span>
        </div>
        <h3>When considering an upgrade for your AI and R&D workflows, it’s important to first reflect on your current situation and goals.</h3> 
          
          <p>Are you just beginning to explore AI and looking for a straightforward, cost-effective way to get started? If so, purchasing a single RTX 5090 GPU to install in your existing system is an excellent choice. This option offers simplicity and affordability while providing powerful, modern AI capabilities that can handle exploratory research and development without the need for a high-end setup. The 5090 delivers impressive performance that even outpaces a 4x3090 setup in many general AI tasks, making it ideal for those still testing the waters.</p>

<p>If you don’t yet have a capable system that can fully leverage the 5090’s power, and you’re still in the exploration or testing phase without a defined pipeline, building a high-end consumer desktop might be the best path. This approach offers flexibility and future upgrade options without the upfront cost of workstation or server-grade hardware. A high-end desktop is versatile, powerful, and can be repurposed or sold later, helping you avoid overspending on unknown hardware needs while still supporting a broad range of AI workloads.</p>

<p>On the other hand, if you have a specific, demanding use case—such as processing massive datasets like 15 million PDF files as you previously mentioned—a server-grade build equipped with 4x3090 GPUs is the optimal solution. This configuration delivers exceptional value and raw power tailored for heavy parallel processing tasks. In scenarios requiring sustained, large-scale computation, the 4x3090 setup outperforms a single 5090 by distributing workloads efficiently across multiple GPUs, making it the go-to choice for focused, high-throughput projects.</p>

<p>Finally, if budget is less of a concern and you want to future-proof your investment with the absolute best performance, a workstation built around a Threadripper CPU is unmatched. This powerhouse setup surpasses all other options in raw computing ability, scalability, and longevity. While it represents a significant upfront investment with less immediate return, it provides your company with a competitive edge—whether through winning bids, impressing partners, or accelerating innovation. This build is not just hardware; it’s a strategic asset that signals your commitment to leading-edge R&D.</p>
      </div>

      <div class="card">
        <div class="section-title">
          <h2>Recommendations (loadable presets)</h2>
          <span class="tag">Quick start</span>
        </div>
        <div id="recommendations" class="small"></div>
      </div>
    </section>

    <section class="card" id="picker">
      <div class="section-title">
        <h2>Customize your build (compatibility‑aware picker)</h2>
        <span class="small">Real‑time price summary, export, and compare</span>
      </div>

      <div class="flex" style="justify-content: space-between; margin-bottom: 8px;">
        <div class="flex">
          <span class="small muted">Active Build Type:</span>
          <span id="bt-badge" class="pill">Any</span>
          <button id="btn-reset-bt" class="ghost">Reset Build Type</button>
        </div>
        <div class="flex">
          <button id="btn-add-compare" class="accent">Add to Compare</button>
          <button id="btn-show-compare" class="primary">Compare (<span id="compare-count" class="badge">0</span>/3)</button>
          <button id="btn-clear-compare" class="ghost">Clear Compare</button>
        </div>
      </div>

      <p class="muted">Choose components from our curated catalog below. Once a part with a specific Build Type is selected (e.g., Server, High‑end PC, Workstation), other options auto‑filter to compatible items. You can add multiple items per category (e.g., multiple NVMe or HDDs).</p>

      <div id="picker-types"></div>

      <div class="summary">
        <div class="flex" style="justify-content: space-between;">
          <div>
            <div class="small muted">Selected items</div>
            <div id="selected-count" class="mono">0 lines</div>
          </div>
          <div>
            <div class="small muted">Grand total</div>
            <div id="grand-total" class="total mono">Rp0</div>
          </div>
        </div>
        <div class="btn-row" style="margin-top: 8px;">
          <button id="btn-export" class="accent">Export selection as text</button>
          <button id="btn-copy" class="ghost">Copy to clipboard</button>
          <button id="btn-reset" class="warn">Reset picker</button>
        </div>
        <div id="export-preview" class="small muted" style="margin-top:6px; white-space: pre-wrap;"></div>
      </div>
    </section>

    <section class="card">
      <div class="section-title">
        <h2>Notes and assumptions</h2>
      </div>
      <ul class="small" style="margin: 0 0 0 18px;">
        <li>Prices are indicative and may vary with stock; second‑hand items (e.g., EXOS X18) include basic health checks and limited warranty.</li>
        <li>Quote excludes taxes unless stated otherwise. Build/commissioning covered by the chosen service tier; OS install, firmware updates, stress tests, and burn‑in are included.</li>
        <li>Storage: we can provision ZFS with ARC cap and special vdevs for small‑file/metadata acceleration, and set up nightly snapshots/replication as requested.</li>
        <li>Software stack examples: Qdrant/Milvus for vectors; OpenSearch for keyword/filters; E5/BGE encoders for embeddings; bge‑reranker/monoT5 for rerank.</li>
      </ul>
    </section>
  </div>

  <!-- Compare Modal -->
  <div id="compare-modal">
    <div class="modal-card">
      <div class="section-title">
        <h3>Compare Builds</h3>
        <button id="btn-close-compare" class="ghost">Close</button>
      </div>
      <div id="compare-body"></div>
    </div>
  </div>

  <!-- Parts data from Update Handpicked Part.xlsx, with Build Type for compatibility -->
  <script id="parts-data" type="application/json">
  {
    "part_types": ["Motherboard","CPU","CPU Cooler","RAM","GPU","NVME SSD","HDD","PSU","PCIE Riser","Case","UPS","Service"],
    "records": [
      {"No":1,"Parts Type":"Motherboard","Model":"H12SSL-i","Specs":"5 × PCIe 4.0 x16, 2 × PCIe 4.0 x8","Specs.1":"305 × 244 (ATX)","Specs.2":"2 × M.2 PCIe 4.0 x4","Specs.3":"8 × SATA3, 1 × SlimSAS x8 (2 NVMe or 8 SATA)","Specs.4":"Single Socket CPU","Sell Price":14596900,"Build Type":"Server","Compatibility":"SP3","Unnamed: 11":"PCIE 4.0"},
      {"No":2,"Parts Type":"Motherboard","Model":"Huananzhi H12D","Specs":"4 × PCIe 3.0/4.0 x16","Specs.1":"305 × 245 (ATX)","Specs.2":"3 × M.2 PCIe 3.0/4.0 x4","Specs.3":"4 × SATA3, 3 × SFF-8643 (12 SATA or 3 U.2 PCIe 3.0/4.0 x4)","Specs.4":"Single Socket CPU","Sell Price":8950000,"Build Type":"Server","Compatibility":"SP3","Unnamed: 11":"PCIE 4.0"},
      {"No":3,"Parts Type":"Motherboard","Model":"MZ32-AR0 (new)","Specs":"5 × PCIe Gen4 (x16/x8), 2 × PCIe Gen3 (x16/x8)","Specs.1":"305 × 330 (E-ATX)","Specs.2":"2 × M.2 PCIe Gen3 x4","Specs.3":"4 × SlimSAS (Gen4 NVMe), 2 × SlimSAS (8 × SATA), 8 × SATA total","Specs.4":"Single Socket CPU","Sell Price":10268400,"Build Type":"Server","Compatibility":"SP3","Unnamed: 11":"PCIE 4.0"},
      {"No":6,"Parts Type":"Motherboard","Model":"H12SSL-NT","Specs":"5 × PCIe 4.0 x16, 2 × PCIe 4.0 x8","Specs.1":"305 × 244 (ATX)","Specs.2":"2 × M.2 PCIe 4.0 x4","Specs.3":"2 × SlimSAS x8 (each: 8 SATA3 or 2 NVMe), Dual 10GBase-T","Specs.4":"Single Socket CPU","Sell Price":14917500,"Build Type":"Server","Compatibility":"SP3","Unnamed: 11":"PCIE 4.0"},

      {"No":8,"Parts Type":"NVME SSD","Model":"Samsung 990 Pro 2TB","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":2845000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 4.0"},
      {"No":9,"Parts Type":"NVME SSD","Model":"WD Black SN850X 2TB","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":2500000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 4.0"},
      {"No":10,"Parts Type":"NVME SSD","Model":"Samsung 990 Pro 4TB","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":4890000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 4.0"},

      {"No":11,"Parts Type":"CPU Cooler","Model":"ARCTIC FREEZER 4U-M","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":850000,"Build Type":"Server","Compatibility":"SP3;sWRX8;sTR5","Unnamed: 11":null},

      {"No":12,"Parts Type":"CPU","Model":"7702","Specs":"64 / 128","Specs.1":"512MB","Specs.2":"2063","Specs.3":"68870","Specs.4":null,"Sell Price":8510060,"Build Type":"Server","Compatibility":"SP3","Unnamed: 11":"PCIE 4.0"},
      {"No":20,"Parts Type":"CPU","Model":"7B13","Specs":"64 / 128","Specs.1":"256MB","Specs.2":"2534","Specs.3":"78064","Specs.4":null,"Sell Price":12133100,"Build Type":"Server","Compatibility":"SP3","Unnamed: 11":"PCIE 4.0"},
      {"No":23,"Parts Type":"CPU","Model":"7763","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":18866200,"Build Type":"Server","Compatibility":"SP3","Unnamed: 11":"PCIE 4.0"},
      {"No":24,"Parts Type":"CPU","Model":"7V13","Specs":"64 / 128","Specs.1":"256MB","Specs.2":"2729","Specs.3":"82878","Specs.4":null,"Sell Price":21110600,"Build Type":"Server","Compatibility":"SP3","Unnamed: 11":"PCIE 4.0"},

      {"No":25,"Parts Type":"PSU","Model":"Super Flower LEADEX III GOLD 1300w Gold","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":2500000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"All"},

      {"No":26,"Parts Type":"RAM","Model":"8*3200AA DDR4 ECC 32GB","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":7840000,"Build Type":"Server","Compatibility":"SP3","Unnamed: 11":"PCIE 4.0"},
      {"No":27,"Parts Type":"RAM","Model":"8*3200AA DDR4 ECC 64GB","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":12800000,"Build Type":"Server","Compatibility":"SP3","Unnamed: 11":"PCIE 4.0"},

      {"No":28,"Parts Type":"Case","Model":"Open Rack (custom)","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":2500000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"All"},

      {"No":29,"Parts Type":"HDD","Model":"Seagate EXOS X18 HDD 18TB (second)","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":5100000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"All"},
      {"No":30,"Parts Type":"HDD","Model":"Seagate EXOS X18 HDD 18TB (new)","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":11738000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"All"},

      {"No":31,"Parts Type":"GPU","Model":"RTX 3090","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":11500000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 4.0"},

      {"No":32,"Parts Type":"PCIE Riser","Model":"PCIE 4.0 Riser","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":40000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 4.0"},

      {"No":33,"Parts Type":"UPS","Model":"APC SRV3KI-E 2700W (new)","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":12400000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"All"},
      {"No":34,"Parts Type":"UPS","Model":"SURTD3000XLI (new)","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":13500000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"All"},

      {"No":35,"Parts Type":"Service","Model":"Basic — Build & Commission","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":12500000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"All"},
      {"No":36,"Parts Type":"Service","Model":"Standard — Hardware Optimized","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":15000000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"All"},
      {"No":37,"Parts Type":"Service","Model":"Premium — Enterprise Care","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":19500000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"All"},

      {"No":38,"Parts Type":"CPU","Model":"Threadripper PRO 9955WX","Specs":"16 / 32","Specs.1":"64MB","Specs.2":"4561","Specs.3":"69993","Specs.4":null,"Sell Price":31790000,"Build Type":"Workstation","Compatibility":"sTR5","Unnamed: 11":"PCIE 5.0"},
      {"No":39,"Parts Type":"CPU","Model":"Threadripper PRO 9965WX","Specs":"24 / 48","Specs.1":"128MB","Specs.2":"4540","Specs.3":"94721","Specs.4":null,"Sell Price":56790000,"Build Type":"Workstation","Compatibility":"sTR5","Unnamed: 11":"PCIE 5.0"},
      {"No":40,"Parts Type":"CPU","Model":"Threadripper PRO 9975WX","Specs":"32 / 64","Specs.1":"128MB","Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":80790000,"Build Type":"Workstation","Compatibility":"sTR5","Unnamed: 11":"PCIE 5.0"},
      {"No":41,"Parts Type":"CPU","Model":"Threadripper PRO 9985WX","Specs":"64 / 128","Specs.1":"256MB","Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":159790000,"Build Type":"Workstation","Compatibility":"sTR5","Unnamed: 11":"PCIE 5.0"},

      {"No":43,"Parts Type":"Motherboard","Model":"Asrock WRX90 WS EVO","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":19725000,"Build Type":"Workstation","Compatibility":"sTR5","Unnamed: 11":"PCIE 5.0"},
      {"No":44,"Parts Type":"Motherboard","Model":"ASUS Pro WS WRX90E-SAGE","Specs":null,"Specs.1":null,"Specs.2":null,"Specs.3":null,"Specs.4":null,"Sell Price":22950000,"Build Type":"Workstation","Compatibility":"sTR5","Unnamed: 11":"PCIE 5.0"},

      {"No":45,"Parts Type":"CPU","Model":"Threadripper PRO 7965WX","Sell Price":51189000,"Build Type":"Workstation","Compatibility":"sTR5","Unnamed: 11":"PCIE 5.0"},
      {"No":46,"Parts Type":"CPU","Model":"Threadripper PRO 7975WX","Sell Price":70415000,"Build Type":"Workstation","Compatibility":"sTR5","Unnamed: 11":"PCIE 5.0"},

      {"No":48,"Parts Type":"RAM","Model":"8*32GB 5600Mhz DDR5 ECC","Sell Price":29275200,"Build Type":"Workstation","Compatibility":"sTR5","Unnamed: 11":"DDR5 ECC"},
      {"No":49,"Parts Type":"RAM","Model":"8*64GB 5600Mhz DDR5 ECC","Sell Price":48960000,"Build Type":"Workstation","Compatibility":"sTR5","Unnamed: 11":"DDR5 ECC"},

      {"No":50,"Parts Type":"GPU","Model":"RTX 5090 Gainward Phantom","Sell Price":40800000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 5.0"},
      {"No":51,"Parts Type":"GPU","Model":"RTX 5090 Inno3D X3 Enormous","Sell Price":40472000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 5.0"},
      {"No":52,"Parts Type":"GPU","Model":"RTX 5090 Zotac Solid OC","Sell Price":43800000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 5.0"},
      {"No":53,"Parts Type":"GPU","Model":"RTX 5090 ASUS ROG Astral OC","Sell Price":57230000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 5.0"},
      {"No":54,"Parts Type":"GPU","Model":"RTX 5090 ASUS TUF OC","Sell Price":44400000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 5.0"},
      {"No":55,"Parts Type":"GPU","Model":"RTX 5090 MSI Vanguard OC","Sell Price":46625000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 5.0"},
      {"No":56,"Parts Type":"GPU","Model":"RTX 5090 MSI Ventus","Sell Price":41550000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 5.0"},
      {"No":57,"Parts Type":"GPU","Model":"RTX 5090 Aorus","Sell Price":53450000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 5.0"},

      {"No":58,"Parts Type":"CPU","Model":"Core Ultra 9 285K","Specs":"24 / 24","Specs.1":"36MB","Sell Price":9950000,"Build Type":"High-end PC","Compatibility":"LGA 1851","Unnamed: 11":"PCIE 5.0"},
      {"No":59,"Parts Type":"CPU","Model":"Ryzen 9 9950X3D","Specs":"16 / 32","Specs.1":"128MB","Sell Price":12445000,"Build Type":"High-end PC","Compatibility":"AM5","Unnamed: 11":"PCIE 5.0"},
      {"No":60,"Parts Type":"Motherboard","Model":"ASRock Phantom Gaming X870E Nova WiFi","Sell Price":6695000,"Build Type":"High-end PC","Compatibility":"AM5","Unnamed: 11":"PCIE 5.0"},
      {"No":61,"Parts Type":"Motherboard","Model":"ASRock Z890 Nova WiFi 7","Sell Price":7075000,"Build Type":"High-end PC","Compatibility":"LGA 1851","Unnamed: 11":"PCIE 5.0"},
      {"No":62,"Parts Type":"RAM","Model":"64GB (32GB*2) Corsair DOMINATOR TITANIUM RGB DDR5-6600 CL32","Sell Price":5300000,"Build Type":"High-end PC","Compatibility":"LGA 1851","Unnamed: 11":"PCIE 5.0"},
      {"No":63,"Parts Type":"RAM","Model":"64GB (32GB*2) G.Skill Trident Z Royal Neo DDR5-6000 CL26","Sell Price":4950000,"Build Type":"High-end PC","Compatibility":"AM5","Unnamed: 11":"PCIE 5.0"},

      {"No":64,"Parts Type":"Case","Model":"Phanteks Enthoo 719 (EATX)","Sell Price":3087500,"Build Type":"Workstation","Compatibility":"All","Unnamed: 11":"PCIE 5.0"},

      {"No":65,"Parts Type":"NVME SSD","Model":"MSI Spatium M580 FROZR M.2 NVMe PCIe Gen5 x4 4TB","Sell Price":8587000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 5.0"},
      {"No":66,"Parts Type":"NVME SSD","Model":"MSI Spatium M580 FROZR M.2 NVMe PCIe Gen5 x4 2TB","Sell Price":4802000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 5.0"},
      {"No":67,"Parts Type":"NVME SSD","Model":"Teamgroup SSD T-FORCE GE PRO PCIe Gen5x4 4TB","Sell Price":6750000,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 5.0"},
      {"No":68,"Parts Type":"NVME SSD","Model":"Teamgroup SSD T-FORCE GE PRO PCIe Gen5x4 2TB","Sell Price":3657500,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 5.0"},

      {"No":69,"Parts Type":"Case","Model":"Corsair 5000D Airflow (MID ATX)","Sell Price":2235000,"Build Type":"High-end PC","Compatibility":"All","Unnamed: 11":"All"},

      {"No":70,"Parts Type":"CPU Cooler","Model":"Noctua NH-U14S TR5-SP6","Sell Price":2037750,"Build Type":"Workstation","Compatibility":"sWRX8;sTR5","Unnamed: 11":"PCIE 5.0"},
      {"No":71,"Parts Type":"PCIE Riser","Model":"PCIE 5.0 Riser","Sell Price":1187500,"Build Type":"All","Compatibility":"All","Unnamed: 11":"PCIE 5.0"},

      {"No":72,"Parts Type":"CPU Cooler","Model":"ARCTIC Liquid Freezer III","Sell Price":1811650,"Build Type":"High-end PC","Compatibility":"LGA 1851;AM5","Unnamed: 11":"PCIE 5.0"}
    ]
  }
  </script>

  <script>
    // Utilities
    const fmtIDR = (n) => 'Rp' + Math.round(n || 0).toLocaleString('id-ID');
    const dateStr = () => new Date().toLocaleString('id-ID');

    // Load data
    const RAW = JSON.parse(document.getElementById('parts-data').textContent);
    const PARTS = RAW.records.map(r => ({
      type: String(r["Parts Type"] || '').trim(),
      model: String(r["Model"] || '').trim(),
      price: Math.round(Number(r["Sell Price"] || 0)),
      specs: [r["Specs"], r["Specs.1"], r["Specs.2"], r["Specs.3"], r["Specs.4"]].filter(Boolean).join(' • '),
      bt: String(r["Build Type"] || 'All').trim(),
      compat: String(r["Compatibility"] || 'All').trim(),
      bus: String(r["Unnamed: 11"] || '').trim()
    })).filter(x => x.type && x.model);

    // Build index for quick lookup by model
    const MODEL_MAP = {};
    PARTS.forEach(p => { MODEL_MAP[p.model] = p; });

    // Types order and grouping
    const TYPES_ORDER = ["CPU","Motherboard","CPU Cooler","RAM","GPU","NVME SSD","HDD","Case","PSU","PCIE Riser","UPS","Service"];
    const TYPE_GROUPS = {};
    PARTS.forEach(p => {
      TYPE_GROUPS[p.type] = TYPE_GROUPS[p.type] || [];
      TYPE_GROUPS[p.type].push(p);
    });
    Object.keys(TYPE_GROUPS).forEach(t => TYPE_GROUPS[t].sort((a,b) => a.model.localeCompare(b.model)));

    // Compatibility state
    let activeBuildType = null; // null = Any
    const btBadge = () => document.getElementById('bt-badge').textContent = activeBuildType || 'Any';

    // Picker DOM
    const pickerRoot = document.getElementById('picker-types');
    const rows = []; // track dynamic rows for totals/export

    function filteredOptions(type) {
      const opts = TYPE_GROUPS[type] || [];
      if (!activeBuildType || activeBuildType === 'Any') return opts;
      return opts.filter(o => (o.bt === activeBuildType) || (o.bt === 'All'));
    }

    function makeTypeBlock(type) {
      const block = document.createElement('div');
      block.className = 'picker-type';
      block.dataset.type = type;

      const header = document.createElement('div');
      header.className = 'flex';
      header.style.justifyContent = 'space-between';

      const h4 = document.createElement('h4');
      h4.textContent = type;
      header.appendChild(h4);

      const addBtn = document.createElement('button');
      addBtn.textContent = `Add ${type}`;
      addBtn.className = 'btn accent';
      addBtn.onclick = () => addRow(block, type);
      header.appendChild(addBtn);

      const rowsWrap = document.createElement('div');
      rowsWrap.className = 'rows-wrap';

      block.appendChild(header);
      block.appendChild(rowsWrap);
      return block;
    }

    function buildSelectOptions(sel, type) {
      sel.innerHTML = '';
      const opt0 = document.createElement('option');
      opt0.value = '';
      opt0.textContent = `Select a ${type}…`;
      sel.appendChild(opt0);

      filteredOptions(type).forEach(o => {
        const opt = document.createElement('option');
        opt.value = o.model;
        opt.textContent = `${o.model} — ${fmtIDR(o.price)}`;
        opt.dataset.price = String(o.price);
        opt.dataset.specs = o.specs || '';
        opt.dataset.bt = o.bt || 'All';
        sel.appendChild(opt);
      });
    }

    function refreshAllSelects() {
      rows.forEach(rowEl => {
        const type = rowEl.closest('.picker-type')?.dataset.type || '';
        const sel = rowEl.querySelector('select');
        const selectedModel = sel.value;
        buildSelectOptions(sel, type);
        // Restore selection if still compatible/available
        const idx = Array.from(sel.options).findIndex(o => o.value === selectedModel);
        sel.selectedIndex = idx >= 0 ? idx : 0;
      });
      btBadge();
    }

    function addRow(block, type, preset = null) {
      const rowEl = document.createElement('div');
      rowEl.className = 'picker-row';

      const sel = document.createElement('select');
      buildSelectOptions(sel, type);

      const qty = document.createElement('input');
      qty.type = 'number';
      qty.min = '0';
      qty.step = '1';
      qty.value = '0';

      const sub = document.createElement('div');
      sub.className = 'row-sub mono';
      sub.textContent = fmtIDR(0);

      const rmv = document.createElement('button');
      rmv.className = 'rmv';
      rmv.textContent = '✕';
      rmv.title = 'Remove this line';

      const specLine = document.createElement('div');
      specLine.className = 'small muted';
      specLine.style.gridColumn = '1 / -1';
      specLine.textContent = '';

      function recalc() {
        const price = Number(sel.selectedOptions[0]?.dataset.price || 0);
        const override = Number(rowEl.dataset.overridePrice || 0);
        const usedPrice = override || price;
        const q = Number(qty.value || 0);
        sub.textContent = fmtIDR(usedPrice * q);
        specLine.textContent = sel.value && sel.selectedOptions[0]?.dataset.specs
          ? 'Specs: ' + sel.selectedOptions[0].dataset.specs
          : '';
        grandTotal();
      }

      sel.addEventListener('change', () => {
        const selectedBT = sel.selectedOptions[0]?.dataset.bt || 'All';
        // Enforce Build Type compatibility
        if (!activeBuildType && selectedBT && selectedBT !== 'All') {
          activeBuildType = selectedBT;
          refreshAllSelects();
        } else if (activeBuildType && selectedBT && selectedBT !== 'All' && selectedBT !== activeBuildType) {
          alert(`This part is for Build Type "${selectedBT}" and is not compatible with the current active Build Type "${activeBuildType}".`);
          sel.selectedIndex = 0;
          recalc();
          return;
        }
        if (sel.value && qty.value === '0') qty.value = '1';
        rowEl.dataset.overridePrice = '';
        recalc();
      });

      qty.addEventListener('change', recalc);

      rmv.addEventListener('click', () => {
        rowEl.remove();
        const idx = rows.indexOf(rowEl);
        if (idx >= 0) rows.splice(idx, 1);
        grandTotal();
      });

      rowEl.appendChild(sel);
      rowEl.appendChild(qty);
      rowEl.appendChild(sub);
      rowEl.appendChild(rmv);
      rowEl.appendChild(specLine);

      block.querySelector('.rows-wrap').appendChild(rowEl);
      rows.push(rowEl);

      // Preset
      if (preset) {
        const idx = Array.from(sel.options).findIndex(o => o.value === String(preset.model));
        if (idx >= 0) {
          // Check BT auto-lock on preset item
          const bt = sel.options[idx].dataset.bt || 'All';
          if (!activeBuildType && bt !== 'All') {
            activeBuildType = bt;
            refreshAllSelects();
          }
          sel.selectedIndex = idx;
          qty.value = String(preset.qty ?? 1);
          if (preset.overridePrice != null) {
            rowEl.dataset.overridePrice = String(preset.overridePrice);
          }
        }
        recalc();
      }
    }

    function bootPicker() {
      pickerRoot.innerHTML = '';
      rows.length = 0;
      TYPES_ORDER.forEach(type => {
        if (!TYPE_GROUPS[type]) return;
        const block = makeTypeBlock(type);
        pickerRoot.appendChild(block);
        addRow(block, type);
      });
    }

    function currentSelections() {
      const lines = [];
      rows.forEach(rowEl => {
        const type = rowEl.closest('.picker-type')?.dataset.type || '';
        const sel = rowEl.querySelector('select');
        const qty = Number(rowEl.querySelector('input').value || 0);
        if (!sel || !sel.value || qty <= 0) return;
        const price = Number(sel.selectedOptions[0]?.dataset.price || 0);
        const override = Number(rowEl.dataset.overridePrice || 0);
        const used = override || price;
        lines.push({
          type,
          model: sel.value,
          unit: used,
          qty,
          subtotal: used * qty
        });
      });
      return lines;
    }

    function grandTotal() {
      const lines = currentSelections();
      const total = lines.reduce((a, b) => a + b.subtotal, 0);
      document.getElementById('grand-total').textContent = fmtIDR(total);
      document.getElementById('selected-count').textContent = `${lines.length} line${lines.length === 1 ? '' : 's'}`;
      const preview = [
        `Custom Build — ${dateStr()}`,
        ''.padEnd(22, '—'),
        ...lines.map(l => `- ${l.type}: ${l.model} ×${l.qty} @ ${fmtIDR(l.unit)} = ${fmtIDR(l.subtotal)}`),
        ''.padEnd(22, '—'),
        `Grand Total: ${fmtIDR(total)}`
      ].join('\n');
      document.getElementById('export-preview').textContent = preview;
      return { lines, total, preview };
    }

    function exportText(saveToFile = true) {
      const { preview } = grandTotal();
      if (!saveToFile) return preview;
      const blob = new Blob([preview], { type: 'text/plain;charset=utf-8' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `custom_build_${Date.now()}.txt`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(a.href);
    }

    function copyText() {
      const { preview } = grandTotal();
      navigator.clipboard.writeText(preview).then(() => {
        alert('Selection copied to clipboard.');
      }).catch(() => {
        alert('Copy failed. You can select the preview text and copy it manually.');
      });
    }

    function resetPicker() {
      pickerRoot.innerHTML = '';
      rows.length = 0;
      activeBuildType = null;
      btBadge();
      bootPicker();
      grandTotal();
    }

    // Presets (4 recommendations), neatly ordered
    const ORDER_FOR_RENDER = ["CPU","Motherboard","CPU Cooler","RAM","GPU","NVME SSD","HDD","Case","PSU","PCIE Riser","UPS","Service"];

    const RECO1 = [
      { type: "GPU", model: "RTX 5090 ASUS ROG Astral OC", qty: 1 }
    ];

    const RECO2 = [
      { type: "CPU", model: "Ryzen 9 9950X3D", qty: 1 },
      { type: "Motherboard", model: "ASRock Phantom Gaming X870E Nova WiFi", qty: 1 },
      { type: "CPU Cooler", model: "ARCTIC Liquid Freezer III", qty: 1 },
      { type: "RAM", model: "64GB (32GB*2) G.Skill Trident Z Royal Neo DDR5-6000 CL26", qty: 1 },
      { type: "GPU", model: "RTX 5090 Inno3D X3 Enormous", qty: 1 },
      { type: "NVME SSD", model: "Teamgroup SSD T-FORCE GE PRO PCIe Gen5x4 2TB", qty: 1 },
      { type: "HDD", model: "Seagate EXOS X18 HDD 18TB (new)", qty: 1 },
      { type: "Case", model: "Corsair 5000D Airflow (MID ATX)", qty: 1 },
      { type: "PSU", model: "Super Flower LEADEX III GOLD 1300w Gold", qty: 1 },
      { type: "UPS", model: "SURTD3000XLI (new)", qty: 1 }
    ];

    const RECO3 = [
      { type: "Motherboard", model: "Huananzhi H12D", qty: 1 },
      { type: "CPU", model: "7702", qty: 1 },
      { type: "CPU Cooler", model: "ARCTIC FREEZER 4U-M", qty: 1 },
      { type: "RAM", model: "8*3200AA DDR4 ECC 32GB", qty: 1 },
      { type: "NVME SSD", model: "WD Black SN850X 2TB", qty: 1 },
      { type: "NVME SSD", model: "Samsung 990 Pro 4TB", qty: 2 },
      { type: "HDD", model: "Seagate EXOS X18 HDD 18TB (second)", qty: 4 },
      { type: "GPU", model: "RTX 3090", qty: 4 },
      { type: "PSU", model: "Super Flower LEADEX III GOLD 1300w Gold", qty: 2 },
      { type: "Case", model: "Open Rack (custom)", qty: 1 },
      { type: "PCIE Riser", model: "PCIE 4.0 Riser", qty: 4 },
      { type: "UPS", model: "APC SRV3KI-E 2700W (new)", qty: 1 },
      { type: "Service", model: "Standard — Hardware Optimized", qty: 1 }
    ];

    const RECO4 = [
      { type: "CPU", model: "Threadripper PRO 9965WX", qty: 1 },
      { type: "Motherboard", model: "ASUS Pro WS WRX90E-SAGE", qty: 1 },
      { type: "CPU Cooler", model: "ARCTIC FREEZER 4U-M", qty: 1 },
      { type: "RAM", model: "8*64GB 5600Mhz DDR5 ECC", qty: 1 },
      { type: "GPU", model: "RTX 5090 Inno3D X3 Enormous", qty: 1 },
      { type: "NVME SSD", model: "Teamgroup SSD T-FORCE GE PRO PCIe Gen5x4 4TB", qty: 2 },
      { type: "NVME SSD", model: "Teamgroup SSD T-FORCE GE PRO PCIe Gen5x4 2TB", qty: 1 },
      { type: "HDD", model: "Seagate EXOS X18 HDD 18TB (new)", qty: 4 },
      { type: "Case", model: "Phanteks Enthoo 719 (EATX)", qty: 1 },
      { type: "UPS", model: "SURTD3000XLI (new)", qty: 1 },
      { type: "Service", model: "Premium — Enterprise Care", qty: 1 }
    ];

    const PRESETS = [
      { key: 'rec1', title: 'Recommendation 1 — Existing PC (Single GPU Upgrade)', items: RECO1, desc: 'Add RTX 5090 to existing PC for strong single‑GPU performance and simplicity.' },
      { key: 'rec2', title: 'Recommendation 2 — High‑end Desktop (AM5)', items: RECO2, desc: 'Modern AM5 platform with fast DDR5, Gen5 NVMe, and a 5090 for production apps.' },
      { key: 'rec3', title: 'Recommendation 3 — Server‑Grade (4×3090)', items: RECO3, desc: 'Server‑grade EPYC build with 4 GPUs for big batch processing and embeddings.' },
      { key: 'rec4', title: 'Recommendation 4 — Workstation Pro (TR PRO 9965WX)', items: RECO4, desc: 'Enterprise‑grade workstation with ECC DDR5 and WRX90E for future‑proofing.' }
    ];

    function calcPresetTotal(items) {
      let total = 0;
      items.forEach(it => {
        const p = MODEL_MAP[it.model];
        const price = p ? p.price : 0;
        total += price * (it.qty || 1);
      });
      return total;
    }

    function renderRecommendations() {
      const root = document.getElementById('recommendations');
      root.innerHTML = '';
      PRESETS.forEach(p => {
        const total = calcPresetTotal(p.items);
        // sort by neat order
        const itemsSorted = [...p.items].sort((a,b) => {
          const ai = ORDER_FOR_RENDER.indexOf(a.type);
          const bi = ORDER_FOR_RENDER.indexOf(b.type);
          return (ai - bi);
        });
        const wrap = document.createElement('div');
        wrap.style.marginBottom = '12px';
        wrap.innerHTML = `
          <div class="section-title">
            <h3 style="margin:0;">${p.title}</h3>
            <span class="mono">${fmtIDR(total)}</span>
          </div>
          <p class="muted">${p.desc}</p>
          <table class="table small">
            <thead><tr><th>Part</th><th>Model</th><th class="mono">Q</th><th class="mono">Unit</th><th class="mono">Subtotal</th></tr></thead>
            <tbody>
              ${itemsSorted.map(it => {
                const part = MODEL_MAP[it.model];
                const unit = part ? part.price : 0;
                const sub = unit * (it.qty || 1);
                return `<tr>
                  <td>${it.type}</td>
                  <td>${it.model}${part && part.bt && part.bt !== 'All' ? ` <span class="small muted">(${part.bt})</span>` : ''}</td>
                  <td class="mono">${it.qty || 1}</td>
                  <td class="mono">${fmtIDR(unit)}</td>
                  <td class="mono">${fmtIDR(sub)}</td>
                </tr>`;
              }).join('')}
            </tbody>
            <tfoot><tr><td colspan="4" class="mono">Total</td><td class="mono">${fmtIDR(total)}</td></tr></tfoot>
          </table>
          <div class="btn-row">
            <button class="primary" data-load="${p.key}">Load this into the picker</button>
          </div>
          <div class="hr"></div>
        `;
        root.appendChild(wrap);
      });

      // Bind load buttons
      root.querySelectorAll('button[data-load]').forEach(btn => {
        btn.addEventListener('click', () => {
          const key = btn.getAttribute('data-load');
          const preset = PRESETS.find(x => x.key === key);
          if (!preset) return;
          loadPreset(preset.items);
        });
      });
    }

    function loadPreset(items) {
      pickerRoot.innerHTML = '';
      rows.length = 0;
      activeBuildType = null;
      btBadge();
      TYPES_ORDER.forEach(type => {
        if (!TYPE_GROUPS[type]) return;
        const block = makeTypeBlock(type);
        pickerRoot.appendChild(block);
      });
      items.forEach(item => {
        const block = Array.from(pickerRoot.children).find(b => b.dataset.type === item.type);
        if (block) addRow(block, item.type, item);
      });
      grandTotal();
    }

    // Compare up to 3 builds
    const COMPARE = []; // array of { name, bt, lines, total, mapByType }
    function addToCompare() {
      if (COMPARE.length >= 3) {
        alert('You can compare up to 3 builds.');
        return;
      }
      const { lines, total } = grandTotal();
      if (!lines.length) {
        alert('Your selection is empty.');
        return;
      }
      const mapByType = {};
      lines.forEach(l => {
        mapByType[l.type] = mapByType[l.type] || [];
        mapByType[l.type].push(l);
      });
      const bt = activeBuildType || 'Any';
      const name = `Build ${COMPARE.length + 1} (${bt})`;
      COMPARE.push({ name, bt, lines, total, mapByType });
      document.getElementById('compare-count').textContent = String(COMPARE.length);
      alert(`Saved "${name}" for comparison.`);
    }

    function clearCompare() {
      COMPARE.length = 0;
      document.getElementById('compare-count').textContent = '0';
    }

    function showCompare() {
      if (!COMPARE.length) {
        alert('No saved builds to compare.');
        return;
      }
      const modal = document.getElementById('compare-modal');
      const body = document.getElementById('compare-body');

      // Collect all types observed across builds
      const allTypes = new Set();
      COMPARE.forEach(b => Object.keys(b.mapByType).forEach(t => allTypes.add(t)));
      const typesSorted = Array.from(allTypes).sort((a,b) => ORDER_FOR_RENDER.indexOf(a) - ORDER_FOR_RENDER.indexOf(b));

      const table = `
        <table class="table small">
          <thead>
            <tr>
              <th>Part</th>
              ${COMPARE.map(b => `<th>${b.name}</th>`).join('')}
            </tr>
          </thead>
          <tbody>
            ${typesSorted.map(t => {
              return `<tr>
                <td>${t}</td>
                ${COMPARE.map(b => {
                  const lines = b.mapByType[t] || [];
                  if (!lines.length) return `<td class="muted small">—</td>`;
                  const txt = lines.map(l => `${l.model} ×${l.qty} (${fmtIDR(l.subtotal)})`).join('<br/>');
                  return `<td>${txt}</td>`;
                }).join('')}
              </tr>`;
            }).join('')}
          </tbody>
          <tfoot>
            <tr>
              <td class="mono"><b>Total</b></td>
              ${COMPARE.map(b => `<td class="mono"><b>${fmtIDR(b.total)}</b></td>`).join('')}
            </tr>
          </tfoot>
        </table>
      `;
      body.innerHTML = table;
      modal.style.display = 'flex';
    }

    // Bind controls
    document.getElementById('btn-export').addEventListener('click', () => exportText(true));
    document.getElementById('btn-copy').addEventListener('click', copyText);
    document.getElementById('btn-reset').addEventListener('click', resetPicker);

    document.getElementById('btn-add-compare').addEventListener('click', addToCompare);
    document.getElementById('btn-show-compare').addEventListener('click', showCompare);
    document.getElementById('btn-clear-compare').addEventListener('click', clearCompare);
    document.getElementById('btn-close-compare').addEventListener('click', () => {
      document.getElementById('compare-modal').style.display = 'none';
    });
    document.getElementById('btn-reset-bt').addEventListener('click', () => {
      activeBuildType = null;
      refreshAllSelects();
    });

    // Init
    btBadge();
    renderRecommendations();
    bootPicker();
    grandTotal();
  </script>
</body>
</html>
